<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
label, button {vertical-align: top;}
textarea {width: 500px; height: 600px;}
</style>
<script>
class CueTrack {
  trackNumber;
  title;
  performer;
  // startTime in mm:ss:ff (where mm can exceed 2 chars when going above 99m)
  startTime = "00:00:00";
  constructor(trackNumber, title, performer, startTime) {
    this.trackNumber = trackNumber;
	this.title = title;
	this.performer = performer;
	this.startTime = startTime;
  }
  
  toCueText() {
    let trackIndent = "  ";
	let trackPropertiesIndent = trackIndent + "  ";
	
	let paddedTrackNumber = this.trackNumber.toString().padStart(2, '0');
	
    let cueText =  trackIndent + "TRACK " + paddedTrackNumber + " AUDIO";
	let cueTitle = trackPropertiesIndent + "TITLE \"" + this.title + "\"";
	let cuePerformer = trackPropertiesIndent + "PERFORMER \"" + this.performer + "\"";
	let cueTrackIndex = trackPropertiesIndent + "INDEX 01 " + this.startTime;
	return [cueText, cueTitle, cuePerformer, cueTrackIndex].join("\n");
  }
}

var asotTracklistToCueSheetUtil = {
  transform(event) {
    console.log("transform");
	let tracklistInput =  document.querySelector("textarea#tracklistInput");	
	tracklistLines = tracklistInput.value.split(/\n/);
	
	let cueEntries = tracklistLines.map(asotTracklistToCueSheetUtil.tracklistLineToCueTrack);
	let tracklistAsCue = cueEntries.map(entry => entry.toCueText()).join("\n");
	
	let cueOutput = document.querySelector("textarea#cueOutput");
	cueOutput.value = tracklistAsCue;
  },
  
  tracklistLineToCueTrack(tracklistLine, index) {
    let parsedTrackLine = tracklistLine.match(/^\s*-?\s*(?<artist>[^-]+)\s*-\s*(?<title>[^-]*)\s*\((?<startTime>\d+:\d+:\d+)\)\s*$/i);
	console.debug(parsedTrackLine);
	if (!parsedTrackLine) {
	  console.warn("No match for track line", tracklistLine);
	  return null;
	}
	let artist = parsedTrackLine.groups.artist.trim();
	let title = parsedTrackLine.groups.title.trim();
	let startTimeHms = parsedTrackLine.groups.startTime.trim();
	let startTimeMsf = asotTracklistToCueSheetUtil.convertTimeToCueMinSecFrame(startTimeHms);
	
    let cueTrack = new CueTrack(++index, title, artist, startTimeMsf);
    return cueTrack;
  },
  
  convertTimeToCueMinSecFrame(timeStringInHourMinSec) {
    let parsedTimeInHourMinSec = timeStringInHourMinSec.match(/(?<hours>\d{1,2}):(?<minutes>\d{1,2}):(?<seconds>\d{1,2})/i);
	let parsedHours = Number.parseInt(parsedTimeInHourMinSec.groups.hours);
	let parsedMinutes = Number.parseInt(parsedTimeInHourMinSec.groups.minutes);
	let parsedSeconds = Number.parseInt(parsedTimeInHourMinSec.groups.seconds);
	
	// Cue timestamps don't have hours in, so add hours as extra minutes
	let cueMinutes = parsedHours*60 + parsedMinutes;
	let defaultFrame = "00"; // Don't need granularity down to frames, just leave as zero
	
	return cueMinutes.toString().padStart(2, '0') + ":" + parsedSeconds.toString().padStart(2, '0') + ":" + defaultFrame;
  }
};
</script>
</head>
<body>
<h1>A State of Trance - YouTube Tracklist to Cue Sheet</h1>
<p>Take tracklist from YouTube episode details: <a href="https://www.youtube.com/channel/UCu5jfQcpRLm9xhmlSd5S8xw">Armin van Buuren YouTube channel</a></p>
<label for="tracklistInput">Tracklist</label>
<textarea id="tracklistInput"></textarea>
<button id="transformButton" onclick="asotTracklistToCueSheetUtil.transform(event);">Transform</button>
<label for="cueOutput">Cue sheet output</label>
<textarea id="cueOutput"></textarea>
</body>
</html>